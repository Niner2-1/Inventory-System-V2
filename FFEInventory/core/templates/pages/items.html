{% extends 'base.html' %}



{% block content %}


<section class="content">
  <div class="row">
    <div class="col-xs-12">
      <div class="box">
        <div class="box-header with-border">
          <a href="#addnew"
             data-toggle="modal"
             class="btn btn-primary btn-sm btn-flat"><i class="fa fa-plus"></i> New</a>
        </div>
        <div class="box-body">
          <table id="example1" class="table table-bordered">
            <thead>
              <th>FFE Number</th>
              <th>Others</th>
              <th>Description</th>
              <th>Cost</th>
              <th>Date Purchased</th>
              <th>Location</th>
              <th>Action</th>
            </thead>
            <tbody>
              {% for i in items %}
        
              <tr class="bg-gray-100 hover:bg-gray-200">
                <th
                  scope="row"
                  class="px-6 py-4 font-medium text-gray-900 whitespace-nowrap"
                >
                  {{i.FFE_number}}
                </th>
                <td class="px-6 py-4">{{i.item_type}}</td>
        
                <td class="px-6 py-4">{{i.others}}</td>
                <td class="px-6 py-4">{{i.description}}</td>
                <td class="px-6 py-4">{{i.cost}}</td>
                <td class="px-6 py-4">{{i.date_purchased}}</td>
                <td class="px-6 py-4">{{i.current_branch}}</td>
                <td class="px-6 py-4 text-right">
                  <a href="#" class="font-medium text-blue-600 hover:underline">View</a>
                  <a href="#" class="font-medium text-blue-600 hover:underline">Edit</a>
                </td>
              </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>
      </div>
    </div>
  </div>
</section>


{% comment %} ------------------------------------------------------------------------------------------ {% endcomment %}
<div class="w-full relative overflow-x-auto shadow-md sm:rounded-lg">
  <table
    class="w-full text-sm text-left rtl:text-right text-gray-500 overflow-x-scroll"
  >
    <thead class="text-xs text-gray-700 uppercase bg-gray-300">
      <tr>
        <th scope="col" class="px-6 py-3">FFE Number</th>
        <th scope="col" class="px-6 py-3">FFE Type</th>
        <th scope="col" class="px-6 py-3">Others</th>
        <th scope="col" class="px-6 py-3">Description</th>
        <th scope="col" class="px-6 py-3">Cost</th>
        <th scope="col" class="px-6 py-3">Date Purchased</th>
        <th scope="col" class="px-6 py-3">Location</th>
        <th scope="col" class="px-6 py-3">
          <span class="sr-only">Edit</span>
        </th>
      </tr>
    </thead>
    <tbody>
      {% for i in items %}

      <tr class="bg-gray-100 hover:bg-gray-200">
        <th
          scope="row"
          class="px-6 py-4 font-medium text-gray-900 whitespace-nowrap"
        >
          {{i.FFE_number}}
        </th>
        <td class="px-6 py-4">{{i.item_type}}</td>

        <td class="px-6 py-4">{{i.others}}</td>
        <td class="px-6 py-4">{{i.description}}</td>
        <td class="px-6 py-4">{{i.cost}}</td>
        <td class="px-6 py-4">{{i.date_purchased}}</td>
        <td class="px-6 py-4">{{i.current_branch}}</td>
        <td class="px-6 py-4 text-right">
          <a href="#" class="font-medium text-blue-600 hover:underline">View</a>
          <a href="#" class="font-medium text-blue-600 hover:underline">Edit</a>
        </td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
</div>

<script>
  function sortTable(n) {
    var table,
      rows,
      switching,
      i,
      x,
      y,
      shouldSwitch,
      dir,
      switchcount = 0;
    table = document.getElementById("myTable");
    switching = true;
    // Set the sorting direction to ascending:
    dir = "asc";
    /* Make a loop that will continue until
  no switching has been done: */
    while (switching) {
      // Start by saying: no switching is done:
      switching = false;
      rows = table.rows;
      /* Loop through all table rows (except the
    first, which contains table headers): */
      for (i = 1; i < rows.length - 1; i++) {
        // Start by saying there should be no switching:
        shouldSwitch = false;
        /* Get the two elements you want to compare,
      one from current row and one from the next: */
        x = rows[i].getElementsByTagName("td")[n];
        y = rows[i + 1].getElementsByTagName("td")[n];
        /* Check if the two rows should switch place,
      based on the direction, asc or desc: */
        if (dir == "asc") {
          if (x.innerHTML.toLowerCase() > y.innerHTML.toLowerCase()) {
            // If so, mark as a switch and break the loop:
            shouldSwitch = true;
            break;
          }
        } else if (dir == "desc") {
          if (x.innerHTML.toLowerCase() < y.innerHTML.toLowerCase()) {
            // If so, mark as a switch and break the loop:
            shouldSwitch = true;
            break;
          }
        }
      }
      if (shouldSwitch) {
        /* If a switch has been marked, make the switch
      and mark that a switch has been done: */
        rows[i].parentNode.insertBefore(rows[i + 1], rows[i]);
        switching = true;
        // Each time a switch is done, increase this count by 1:
        switchcount++;
      } else {
        /* If no switching has been done AND the direction is "asc",
      set the direction to "desc" and run the while loop again. */
        if (switchcount == 0 && dir == "asc") {
          dir = "desc";
          switching = true;
        }
      }
    }
  }
</script>

{% endblock content %}
{% block modal %}
  <div class="modal fade" id="addnew">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <button type="button" class="close" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">✕</span>
          </button>
          <h4 class="modal-title">
            <b>Add New Position</b>
          </h4>
        </div>
        <div class="modal-body">
          <form id="positionForm" class="form-horizontal" method="post" action="{% url 'viewPositions' %}">
            {% csrf_token %}
            <div class="modal-body">
                {% for field in form1 %}
                <div class="form-group has-feedback">
                    <span class="text-danger">{{ field.errors }}</span>
                    {{ field.label_tag }}
                    {{ field }}
                </div>
                {% endfor %}
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-default btn-flat pull-left" data-dismiss="modal">
                    <i class="fa fa-close"></i> Close
                </button>
                <button type="submit" class="btn btn-primary btn-flat" name="add">
                    <i class="fa fa-save"></i> Save
                </button>
            </div>
        </form>
        
        <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
        <script>
            $(document).ready(function() {
                $('#positionForm').submit(function(event) {
                    // Prevent default form submission
                    event.preventDefault();
        
                    // Capitalize the value of each input field
                    $(this).find('input[type="text"]').each(function() {
                        $(this).val($(this).val().charAt(0).toUpperCase() + $(this).val().slice(1).toLowerCase());
                    });
        
                    // Submit the form
                    this.submit();
                });
            });
        </script>
        
        </div>
      </div>
    </div>
  </div>
  <!-- Edit -->
  <div class="modal fade" id="edit">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <button type="button" class="close" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">✕</span>
          </button>
          <h4 class="modal-title">
            <b>Edit Position</b>
          </h4>
        </div>
        <div class="modal-body">
          <form id="updatePositionForm" class="form-horizontal" method="post" action="{% url 'updatePosition' %}">
            {% csrf_token %}
            <input type="hidden" class="id" name="id">
            <div class="form-group">
                <label for="name" class="col-sm-3 control-label">Name</label>
                <div class="col-sm-9">
                    <input type="text" class="form-control" id="name" name="name">
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-default btn-flat pull-left" data-dismiss="modal">
                    <i class="fa fa-close"></i> Close
                </button>
                <button type="submit" class="btn btn-success btn-flat" name="edit">
                    <i class="fa fa-check-square-o"></i> Update
                </button>
            </div>
        </form>
        
        <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
        <script>
            $(document).ready(function() {
                $('#updatePositionForm').submit(function(event) {
                    // Prevent default form submission
                    event.preventDefault();
        
                    // Capitalize the value of the 'name' input field
                    var nameField = $(this).find('#name');
                    var capitalizedValue = nameField.val().charAt(0).toUpperCase() + nameField.val().slice(1).toLowerCase();
                    nameField.val(capitalizedValue);
        
                    // Submit the form
                    this.submit();
                });
            });
        </script>
        
        </div>
      </div>
    </div>
  </div>
  <!-- Delete -->
  <div class="modal fade" id="delete">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <button type="button" class="close" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">✕</span>
          </button>
          <h4 class="modal-title">
            <b>Deleting...</b>
          </h4>
        </div>
        <div class="modal-body">
          <form class="form-horizontal"
                method="post"
                action="{% url 'deletePosition' %}">
            <input type="hidden" class="id" name="id">
            {% csrf_token %}
            <div class="text-center">
              <p>DELETE POSITION</p>
              <h2 class="bold fullname"></h2>
            </div>
          </div>
          <div class="modal-footer">
            <button type="button"
                    class="btn btn-default btn-flat pull-left"
                    data-dismiss="modal">
              <i class="fa fa-close"></i> Close
            </button>
            <button type="submit" class="btn btn-danger btn-flat" name="delete">
              <i class="fa fa-trash"></i> Delete
            </button>
          </form>
        </div>
      </div>
    </div>
  </div>
{% endblock modal %}
{% block custom_js %}
  <script>
  $(function() {
      $(document).on('click', '.edit', function(e) {
          e.preventDefault();
          $('#edit').modal('show');
          var id = $(this).data('id');
          getRow(id);
      });

      $(document).on('click', '.delete', function(e) {
          e.preventDefault();
          $('#delete').modal('show');
          var id = $(this).data('id');
          getRow(id);
      });


  });

  function getRow(id) {
      $.ajax({
          type: 'GET',
          {% comment %} url: '{% url "viewPosition" %}', {% endcomment %}
          data: {
              id: id
          },
          dataType: 'json',
          success: function(response) {
              $('.id').val(response.id);
              $('#max_vote').val(response.max_vote);
              $('#name').val(response.name);
              $('.fullname').html(response.name);
          }
      });
  }
  </script>
{% endblock custom_js %}
